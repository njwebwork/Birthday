<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday Megha</title>

  <!-- Comic font -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

  <!-- Bootstrap (styling only) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <style>
    :root{ --bg: linear-gradient(180deg,#0f1720,#0b1020); --accent:#ff6b81; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Comic Neue", cursive;
      background:var(--bg);
      color:#fff;
      overflow-x:hidden;
    }
    /* block scrolling until reveal */
    body.no-scroll{ overflow:hidden; }

    /* preloader */
    #preloader{
      position:fixed; inset:0; z-index:11000;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.75);
    }
    .dots{ display:flex; gap:12px; }
    .dot{ width:14px;height:14px;border-radius:50%;background:#fff; animation:bounce .6s infinite alternate; }
    .dot:nth-child(2){ animation-delay:.12s } .dot:nth-child(3){ animation-delay:.24s }
    @keyframes bounce{ from{transform:translateY(0)} to{transform:translateY(-16px)} }
    #preloader p{ margin-top:12px; color:#ddd; }

    /* countdown */
    #count-screen{
      position:fixed; inset:0; z-index:10900;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      background: rgba(0,0,0,0.8); font-weight:900; transition:opacity .25s;
    }
    #count-num{ font-size:clamp(48px,12vw,120px); line-height:1; }
    #go{ font-size:clamp(22px,6vw,44px); margin-top:8px; display:none; color:var(--accent); }

    /* fireworks canvas */
    #fx-canvas{ position:fixed; inset:0; pointer-events:none; z-index:10800; opacity:0; }

    /* main content (hidden until reveal) */
    #main{ opacity:0; pointer-events:none; transition:opacity .4s; min-height:100vh; }

    /* card layout */
    .card-section{ height:100vh; display:flex; align-items:center; justify-content:center; padding:12px; }
    .card{ width:min(920px,94%); border-radius:18px; overflow:hidden; background:rgba(255,255,255,0.04); color:#fff; box-shadow:0 10px 40px rgba(0,0,0,0.45); }
    .img-wrap{ height:420px; background:#111; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .img-wrap img{ width:100%; height:100%; object-fit:cover; display:block; }
    .card-body{ padding:28px; text-align:center; }
    .title{ font-size:clamp(26px,5vw,40px); font-weight:700; margin-bottom:8px; }
    p.lead{ color:#f3f3f3; font-size:18px; margin:0; }
    .nick{ display:inline-block; padding:6px 10px; background:rgba(255,255,255,0.08); border-radius:999px; margin:0 6px; color:#ffd7df; font-weight:700; }

    /* helper: ensure no initial flash */
    #main, #count-screen { visibility: visible; }
  </style>
</head>
<body class="no-scroll">

  <!-- Preloader -->
  <div id="preloader" aria-hidden="false">
    <div class="dots" aria-hidden="true"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
    <p>Preparing the surpriseâ€¦ hold tight Mega</p>
  </div>

  <!-- Countdown -->
  <div id="count-screen" aria-hidden="true">
    <div id="count-num">3</div>
    <div id="go">GO!</div>
  </div>

  <!-- Fireworks canvas -->
  <canvas id="fx-canvas" aria-hidden="true"></canvas>

  <!-- Main content -->
  <main id="main" aria-hidden="true">
    <section class="container-fluid card-section">
      <article class="card">
        <div class="img-wrap">
          <img id="hero-img" src="img1.jpg" alt="Megha" loading="lazy"
               onerror="this.onerror=null; this.src='https://picsum.photos/1200/700?random=201'">
        </div>
        <div class="card-body">
          <div style="margin-bottom:10px;">
            <span class="nick">Mega</span><span class="nick">Gadhi</span><span class="nick">Bhutani</span>
          </div>
          <h1 class="title">Happy Birthday Megaaaaa!</h1>
          <p class="lead">Ab tu mujase badi ho gai ðŸ¤§</p>
        </div>
      </article>
    </section>

    <section class="container-fluid card-section">
      <article class="card">
        <div class="img-wrap">
          <img src="img2.jpeg" alt="Funny" loading="lazy"
               onerror="this.onerror=null; this.src='https://picsum.photos/1200/700?random=202'">
        </div>
        <div class="card-body">
          <h1 class="title">You are sweet as a cake...</h1>
          <p class="lead">Muje cake nahi mila to tuje chodunga nahi ðŸ™‚ðŸ”ª</p>
        </div>
      </article>
    </section>

    <section class="container-fluid card-section">
      <article class="card">
        <div class="img-wrap">
          <img src="img3.jpg" alt="Silly" loading="lazy"
               onerror="this.onerror=null; this.src='https://picsum.photos/1200/700?random=203'">
        </div>
        <div class="card-body">
          <h1 class="title">Yaha kuch mahi h</h1>
          <p class="lead">Bina cake ke kuch socha nahi ja raha ðŸ˜ž</p>
        </div>
      </article>
    </section>

    <section class="container-fluid card-section">
      <article class="card">
        <div class="img-wrap">
          <img src="img4.jpeg" alt="Silly" loading="lazy"
               onerror="this.onerror=null; this.src='https://picsum.photos/1200/700?random=203'">
        </div>
        <div class="card-body">
<h1 class="title">You are impossibleâ€¦ and irreplaceable</h1>
<p class="lead">
  The world doesn't get another you.
  And I don't want another you.
</p>
<small class="text-light">screen par dikhaya gaya content ChatGPT ke liya gaya he to koi mistake na nikale, agar aapko koi sankoch ho to aap hame Instagram namak aap par suchit kar sakte h dhanywaad.</small>
        </div>
      </article>
    </section>
  </main>

  <!-- Script (complete, synced) -->
  <script>
  (function(){
    const preloader = document.getElementById('preloader');
    const countdownScreen = document.getElementById('count-screen');
    const countNum = document.getElementById('count-num');
    const goText = document.getElementById('go');
    const main = document.getElementById('main');
    const canvas = document.getElementById('fx-canvas');

    // Utility: wait for a single image to load or error
    function imagePromise(img){
      return new Promise(resolve => {
        if (img.complete) return resolve();
        const done = () => { img.removeEventListener('load', done); img.removeEventListener('error', done); resolve(); };
        img.addEventListener('load', done);
        img.addEventListener('error', done);
      });
    }

    // Wait for all images present in the document (including images inside main)
    function waitForAllImages(timeoutMs = 12000){
      const imgs = Array.from(document.images);
      if (imgs.length === 0) return Promise.resolve();
      const promises = imgs.map(imagePromise);
      // Safety timeout
      const timeout = new Promise(resolve => setTimeout(resolve, timeoutMs));
      return Promise.race([ Promise.all(promises), timeout ]);
    }

    // Countdown with GSAP pop animation
    function runCountdown(seconds = 3){
      return new Promise(resolve => {
        countdownScreen.style.display = 'flex';
        countdownScreen.style.opacity = '1';
        let n = seconds;
        countNum.textContent = n;
        gsap.fromTo(countNum, { scale: 0.8, opacity: 0.6 }, { scale: 1, opacity: 1, duration: 0.4, ease: "back.out(2)" });
        const t = setInterval(() => {
          n--;
          if (n > 0){
            countNum.style.display = '';
            goText.style.display = 'none';
            countNum.textContent = n;
            gsap.fromTo(countNum, { scale: 0.8, opacity: 0.6 }, { scale: 1, opacity: 1, duration: 0.35, ease: "back.out(2)" });
          } else {
            clearInterval(t);
            // show GO
            countNum.style.display = 'none';
            goText.style.display = 'block';
            gsap.fromTo(goText, { scale: 0.6, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.45, ease: "back.out(2)" });
            // small delay so GO is visible
            setTimeout(() => {
              // hide countdown
              gsap.to(countdownScreen, { opacity: 0, duration: .35, onComplete: () => {
                countdownScreen.style.display = 'none';
                resolve();
              }});
            }, 650);
          }
        }, 1000);
      });
    }

    // Fireworks (same simple implementation)
    (function initFireworks(){
      const ctx = canvas.getContext('2d');
      let W = canvas.width = innerWidth;
      let H = canvas.height = innerHeight;
      let particles = [], running = false, rafId = null, maker = null;

      window.addEventListener('resize', () => { W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

      function rand(a,b){ return Math.random()*(b-a)+a; }
      function burst(x,y){
        const hue = Math.floor(rand(0,360));
        for(let i=0;i<22;i++){
          const ang = rand(0,Math.PI*2), spd = rand(2,7);
          particles.push({ x,y,vx:Math.cos(ang)*spd, vy:Math.sin(ang)*spd, life:80 + Math.random()*40, age:0, r:2+Math.random()*3, c: `hsla(${hue},90%,60%,1)` });
        }
      }
      function draw(){
        ctx.clearRect(0,0,W,H);
        for(let i=particles.length-1;i>=0;i--){
          const p = particles[i];
          p.vy += 0.06; p.x += p.vx; p.y += p.vy; p.age++;
          const a = Math.max(0,1 - p.age/p.life);
          ctx.globalAlpha = a;
          ctx.fillStyle = p.c;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
          ctx.globalAlpha = 1;
          if (p.age >= p.life) particles.splice(i,1);
        }
        if (running) rafId = requestAnimationFrame(draw);
      }
      function start(){
        if (running) return;
        running = true;
        canvas.style.opacity = '1';
        maker = setInterval(()=> burst(rand(W*0.15,W*0.85), rand(H*0.12,H*0.48)), 260);
        draw();
      }
      function stop(){
        running = false;
        clearInterval(maker);
        if (rafId) cancelAnimationFrame(rafId);
        canvas.style.transition = 'opacity .7s ease';
        canvas.style.opacity = 0;
        setTimeout(()=> { ctx.clearRect(0,0,W,H); canvas.style.display = 'none'; }, 700);
      }

      // expose
      window._fireworks = { start, stop };
    })();

    function triggerFireworksShort(){ if (window._fireworks){ window._fireworks.start(); setTimeout(()=> window._fireworks.stop(), 3000); } }

    // Initialize GSAP scroll animations (run after reveal)
    function initScrollAnimations(){
      gsap.registerPlugin(ScrollTrigger);
      document.querySelectorAll('.card').forEach(card => {
        gsap.fromTo(card, { opacity:0, y: 100, scale: 0.95 }, {
          opacity:1, y:0, scale:1, duration: 1.2, ease: "power3.out",
          scrollTrigger: { trigger: card, start: "top 78%", end: "bottom 20%", scrub: true, invalidateOnRefresh:true }
        });
      });
      // gentle float on hero image
      gsap.to('#hero-img', { y: -10, duration: 4, ease: "sine.inOut", yoyo: true, repeat: -1 });
      setTimeout(()=> ScrollTrigger.refresh(), 80);
    }

    // main flow
    (async function mainFlow(){
      try {
        // 1) wait for images to load (or a reasonable timeout)
        await waitForAllImages(12000); // waits up to 12s, otherwise continues

        // 2) hide preloader (fade)
        gsap.to(preloader, { opacity: 0, duration: 0.28, onComplete: ()=> preloader.style.display = 'none' });

        // tiny guaranteed delay so the fade out is visible
        await new Promise(r => setTimeout(r, 320));

        // 3) run countdown (3 seconds) â€” starts immediately
        await runCountdown(3);

        // 4) reveal main, enable scroll, fireworks, init animations
        main.style.pointerEvents = 'auto';
        document.body.classList.remove('no-scroll');
        gsap.to(main, { opacity: 1, duration: 0.45, ease: "power1.out" });

        // small delay then fireworks + scroll animations
        setTimeout(()=> {
          triggerFireworksShort();
          initScrollAnimations();
        }, 200);

      } catch (err){
        // fallback: if anything goes wrong, still attempt to reveal
        console.error('Flow error:', err);
        if (preloader) preloader.style.display = 'none';
        if (countdownScreen) countdownScreen.style.display = 'none';
        main.style.pointerEvents = 'auto';
        document.body.classList.remove('no-scroll');
        main.style.opacity = '1';
        initScrollAnimations();
      }
    })();

    // Expose waitForAllImages to local scope
    function waitForAllImages(timeoutMs){
      const imgs = Array.from(document.images || []);
      if (imgs.length === 0) return Promise.resolve();
      const loaders = imgs.map(img => new Promise(res => {
        if (img.complete) return res();
        const done = () => { img.removeEventListener('load', done); img.removeEventListener('error', done); res(); };
        img.addEventListener('load', done);
        img.addEventListener('error', done);
      }));
      const all = Promise.all(loaders);
      const timer = new Promise(res => setTimeout(res, timeoutMs));
      return Promise.race([all, timer]);
    }

  })();
  </script>
</body>
</html>